<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#222"><meta name="generator" content="Hexo 5.4.2"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png"><link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png"><link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png"><link rel="mask-icon" href="/images/logo.svg" color="#222"><link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css"><script id="hexo-configurations">var NexT=window.NexT||{},CONFIG={hostname:"wangkexiong.github.io",root:"/",scheme:"Gemini",version:"7.8.0",exturl:!1,sidebar:{position:"left",display:"always",padding:18,offset:12,onmobile:!1},copycode:{enable:!0,show_result:!0,style:"flat"},back2top:{enable:!0,sidebar:!1,scrollpercent:!1},bookmark:{enable:!1,color:"#222",save:"auto"},fancybox:!1,mediumzoom:!1,lazyload:!1,pangu:!1,comments:{style:"tabs",active:null,storage:!0,lazyload:!1,nav:null},algolia:{hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ",hits_stats:" results found in  ms"}},localsearch:{enable:!0,trigger:"auto",top_n_per_article:5,unescape:!1,preload:!1},motion:{enable:!1,async:!1,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}},path:"search.xml"}</script><meta name="description" content="This article describes the fundamental principles of the OSGi development model, using Apache Karaf or ServiceMix as the container."><meta property="og:type" content="article"><meta property="og:title" content="Working with OSGI container Karaf"><meta property="og:url" content="https://wangkexiong.github.io/2015-working-with-osgi-container-karaf/"><meta property="og:site_name" content="Thinking &amp; Writing"><meta property="og:description" content="This article describes the fundamental principles of the OSGi development model, using Apache Karaf or ServiceMix as the container."><meta property="og:locale" content="en_US"><meta property="article:published_time" content="2015-08-07T07:43:00.000Z"><meta property="article:modified_time" content="2023-07-17T11:38:57.173Z"><meta property="article:author" content="wangkexiong"><meta property="article:tag" content="osgi"><meta property="article:tag" content="karaf"><meta name="twitter:card" content="summary"><link rel="canonical" href="https://wangkexiong.github.io/2015-working-with-osgi-container-karaf/"><script id="page-configurations">CONFIG.page={sidebar:"",isHome:!1,isPost:!0,lang:"en"}</script><title>Working with OSGI container Karaf | Thinking & Writing</title><noscript><style>.sidebar-inner,.use-motion .brand,.use-motion .collection-header,.use-motion .comments,.use-motion .menu-item,.use-motion .pagination,.use-motion .post-block,.use-motion .post-body,.use-motion .post-header{opacity:initial}.use-motion .site-subtitle,.use-motion .site-title{opacity:initial;top:initial}.use-motion .logo-line-before i{left:initial}.use-motion .logo-line-after i{right:initial}</style></noscript><link rel="alternate" href="/atom.xml" title="Thinking & Writing" type="application/atom+xml"></head><body itemscope itemtype="http://schema.org/WebPage"><div class="container"><div class="headband"></div><header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-container"><div class="site-nav-toggle"><div class="toggle" aria-label="Toggle navigation bar"><span class="toggle-line toggle-line-first"></span><span class="toggle-line toggle-line-middle"></span><span class="toggle-line toggle-line-last"></span></div></div><div class="site-meta"><a href="/" class="brand" rel="start"><span class="logo-line-before"><i></i></span><h1 class="site-title">Thinking & Writing</h1><span class="logo-line-after"><i></i></span></a></div><div class="site-nav-right"><div class="toggle popup-trigger"><i class="fa fa-search fa-fw fa-lg"></i></div></div></div><nav class="site-nav"><ul id="menu" class="menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-fw fa-home"></i>Home</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-fw fa-archive"></i>Archives<span class="badge">12</span></a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-fw fa-th"></i>Categories<span class="badge">4</span></a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-fw fa-tags"></i>Tags<span class="badge">10</span></a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-fw fa-user"></i>About</a></li><li class="menu-item menu-item-search"><a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search</a></li></ul></nav><div class="search-pop-overlay"><div class="popup search-popup"><div class="search-header"><span class="search-icon"><i class="fa fa-search"></i></span><div class="search-input-container"><input autocomplete="off" autocapitalize="off" placeholder="Searching..." spellcheck="false" type="search" class="search-input"></div><span class="popup-btn-close"><i class="fa fa-times-circle"></i></span></div><div id="search-result"><div id="no-result"><i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i></div></div></div></div></div></header><div class="back-to-top"><i class="fa fa-arrow-up"></i> <span>0%</span></div><div class="reading-progress-bar"></div><a target="_blank" rel="noopener" href="//github.com/wangkexiong" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0 0 115 115 130 115 142 142 250 250 250 0Z"></path><path d="M128.3 109C113.8 99.7 119 89.6 119 89.6 122 82.7 120.5 78.6 120.5 78.6 119.2 72 123.4 76.3 123.4 76.3 127.3 80.9 125.5 87.3 125.5 87.3 122.9 97.6 130.6 101.9 134.4 103.2" fill="currentColor" style="transform-origin:130px 106px" class="octo-arm"></path><path d="M115 115C114.9 115.1 118.7 116.5 119.8 115.4L133.7 101.6C136.9 99.2 139.9 98.4 142.2 98.6 133.8 88 127.5 74.4 143.8 58 148.5 53.4 154 51.2 159.7 51 160.3 49.4 163.2 43.6 171.4 40.1 171.4 40.1 176.1 42.5 178.8 56.2 183.1 58.6 187.2 61.8 190.9 65.4 194.5 69 197.7 73.2 200.1 77.6 213.8 80.2 216.3 84.9 216.3 84.9 212.7 93.1 206.9 96 205.4 96.6 205.1 102.4 203 107.8 198.3 112.5 181.9 128.9 168.3 122.5 157.7 114.1 157.9 116.9 156.7 120.9 152.7 124.9L141 136.5C139.8 137.7 141.6 141.9 141.8 141.8Z" fill="currentColor" class="octo-body"></path></svg></a><main class="main"><div class="main-inner"><div class="content-wrap"><div class="content post posts-expand"><article itemscope itemtype="http://schema.org/Article" class="post-block" lang="en"><link itemprop="mainEntityOfPage" href="https://wangkexiong.github.io/2015-working-with-osgi-container-karaf/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="//www.gravatar.com/avatar/f26b0e5c590dca182ea3b955f73769e7"><meta itemprop="name" content="wangkexiong"><meta itemprop="description" content="Learning, Memory and Knowledge"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="Thinking & Writing"></span><header class="post-header"><h1 class="post-title" itemprop="name headline">Working with OSGI container Karaf</h1><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i></span> <span class="post-meta-item-text">Posted on</span> <time title="Created: 2015-08-07 15:43:00" itemprop="dateCreated datePublished" datetime="2015-08-07T15:43:00+08:00">2015-08-07</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-calendar-check-o"></i></span> <span class="post-meta-item-text">Edited on</span> <time title="Modified: 2023-07-17 19:38:57" itemprop="dateModified" datetime="2023-07-17T19:38:57+08:00">2023-07-17</time></span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-folder-o"></i></span> <span class="post-meta-item-text">In</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/programming/" itemprop="url" rel="index"><span itemprop="name">programming</span></a></span></span><br><span class="post-meta-item" title="Symbols count in article"><span class="post-meta-item-icon"><i class="fa fa-file-word-o"></i></span> <span class="post-meta-item-text">Symbols count in article:</span> <span>24k</span></span><span class="post-meta-item" title="Reading time"><span class="post-meta-item-icon"><i class="fa fa-clock-o"></i></span> <span class="post-meta-item-text">Reading time &asymp;</span> <span>22 mins.</span></span></div></header><div class="post-body" itemprop="articleBody"><p>This article describes the fundamental principles of the OSGi development model, using Apache Karaf or ServiceMix as the container.</p><span id="more"></span><h2 id="karaf-installation-and-startup"><a class="markdownIt-Anchor" href="#karaf-installation-and-startup"></a> Karaf Installation and Startup</h2><p>Before Apache Karaf can provide you with an OSGi-based container runtime, we’ll have to set up our environment first. The process is quick, requiring a minimum of normal Java usage integration work. Package download and installation can follow the guide from <a target="_blank" rel="noopener" href="http://karaf.apache.org">Apache Karaf Project Site</a>. I used 3.0.3 in this tutorial.</p><p>After extracting the Apache Karaf distribution kit and setting environment variables, the container can be started by invoking the Karaf script provided in the bin directory:</p><ul><li><code>bin\karaf</code> in Windows Command Shell</li><li><code>bin/karaf</code> in Linux Shell</li></ul><p>You can use ctrl-D to exit the shell. However, Karaf process dies when you exit the shell. To make Karaf running in the background, you can use script named start under bin directory or install Karaf as service. After that, we can use SSH client or script client under bin directory to connect already running Karaf.</p><p>The easiest way is to run start script:</p><ul><li><code>bin\start</code> in Windows Command Shell</li><li><code>bin/start</code> in Linux Shell</li></ul><p>On Linux, the command shows nothing and run in the background. You can use <code>ps -ef | grep karaf</code> to get the JVM process running with Karaf. While for windows, a shell window will appear. Now we can connect to Karaf using SSH client or client provided by Karaf. By default, Karaf opened SSH port 8101 and create user karaf with password karaf.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ ssh localhost -p 8101 -l karaf</span><br><span class="line">$ bin/client -h localhost -a 8101 -u karaf</span><br></pre></td></tr></table></figure><p>When connected, using crtl-D will not quit the Karaf process, but only the connected client. If you want to quit the background process, use <code>shutdown</code> command provided by Karaf.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">karaf@root()&gt; shutdown</span><br></pre></td></tr></table></figure><p>To install Karaf as service, we can use the wrapper feature provided by Karaf. Start Karaf shell and run the following commands:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">karaf@root()&gt; feature:install wrapper</span><br><span class="line">karaf@root()&gt; wrapper:install -s AUTO_START -n KARAF -d Karaf -D <span class="string">&quot;KarafService&quot;</span></span><br></pre></td></tr></table></figure><p>On Windows platform:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bin\KARAF-service install</span><br></pre></td></tr></table></figure><p>On linux platform:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">huhhot <span class="comment"># ln -s /opt/programming/karaf/bin/KARAF-service /etc/init.d/</span></span><br><span class="line">huhhot <span class="comment"># chkconfig KARAF-service --add</span></span><br><span class="line">huhhot <span class="comment"># chkconfig KARAF-service on</span></span><br></pre></td></tr></table></figure><p>Karaf supports both Felix and Equinox framework for OSGI implementation. You can switch the framework inside kraf.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">karaf@root()&gt; system:framework equinox</span><br><span class="line">Changed OSGi framework to equinox. Karaf needs to be restarted to make the change effective</span><br><span class="line">karaf@root()&gt; system:framework felix</span><br><span class="line">Changed OSGi framework to felix. Karaf needs to be restarted to make the change effective</span><br></pre></td></tr></table></figure><h2 id="build-karaf-osgi-bundle-using-maven"><a class="markdownIt-Anchor" href="#build-karaf-osgi-bundle-using-maven"></a> Build Karaf OSGI Bundle using Maven</h2><p>In this tutorial, we are going to build two OSGI bundles. One to subscribe event messages with topic while the other one to generate event. And finally we will create KAR package for easy installation, in case of Karaf in production environment without Maven repository Internet access.</p><p>The Open Services Gateway Initiative (OSGi), also known as the Dynamic Module System for Java, defines an architecture for modular application development. OSGi container implementations such as Knopflerfish, Equinox, and Apache Felix allow you to break your application into multiple modules and thus more easily manage cross-dependencies between them.</p><p>In OSGi, software is distributed in the form of a bundle. The MANIFEST.MF file acts as deployment descriptor for your bundle. The format for this file is the same as that of a normal JAR file.</p><h3 id="build-from-scratch-for-the-project"><a class="markdownIt-Anchor" href="#build-from-scratch-for-the-project"></a> Build from scratch for the project</h3><p>Maven provides archetype template toolkit to generate skelton code. With that we can do less pom.xml configuration work.</p><p>For the bundle to generate event, named eventpublisher here, will use both Scala and Java programming languages. That is the reason why we use archetype <code>scala-archetype-simple</code> and add bundle related configuration in pom.xml later. For me I think the configurtaion for Scala compiling is much more complex than the one for bundle. Although there are many others archetype for Scala programming, we prefer this one for our tutorial. <code>com.github.igor-petruk.archetypes:maven-archetype-scala-executable</code> is a good choice for Scala programming and it supports latest Scala version.</p><p>The default supported Scala version for <code>scala-archetype-simple</code> is 2.8.0 and that requires JDK version 1.6. Please set <code>JAVA_HOME</code> and <code>PATH</code> environment by yourself.</p><p>Now let’s start from the scratch to build the skelton,</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ mvn archetype:generate -DarchetypeGroupId=org.codehaus.mojo.archetypes -DarchetypeArtifactId=pom-root -DgroupId=tk.wangkexiong.osgi -DartifactId=eventtutorial -Dversion=1.0 -DinteractiveMode=<span class="literal">false</span></span><br><span class="line">$ <span class="built_in">cd</span> eventtutorial</span><br><span class="line">$ mvn archetype:generate -DarchetypeGroupId=org.apache.karaf.archetypes -DarchetypeArtifactId=karaf-command-archetype -DarchetypeVersion=3.0.3 -DgroupId=tk.wangkexiong.osgi -DartifactId=eventconsumer -Dversion=1.0 -Dscope=eventhandler -Dcommand=add -Ddescription=<span class="string">&quot;Add an event listener.&quot;</span> -DinteractiveMode=<span class="literal">false</span></span><br><span class="line">$ mvn archetype:generate -DarchetypeGroupId=org.scala-tools.archetypes -DarchetypeArtifactId=scala-archetype-simple -DgroupId=tk.wangkexiong.osgi -DartifactId=eventpublisher -Dversion=1.0 -DinteractiveMode=<span class="literal">false</span></span><br><span class="line">$ mvn archetype:generate -DarchetypeGroupId=org.apache.karaf.archetypes -DarchetypeArtifactId=karaf-kar-archetype -DarchetypeVersion=3.0.3 -DgroupId=tk.wangkexiong.osgi -DartifactId=eventkar -Dversion=1.0 -DinteractiveMode=<span class="literal">false</span></span><br><span class="line">$ mvn clean package</span><br></pre></td></tr></table></figure><p>There is a basic concept in Maven Multiple Modules Project, which is called reactor. Making KAR package will depend on the eventconsumer and eventpublisher modules. So the module to make KAR package should be after above 2 modules in reactor order. You may ask if we can put KAR package work in root module (eventtutorial in our case). The answer is NO, because root is always the first one to be built in reactor order.</p><blockquote><p>Here is the snippet from the Maven build logs and tells the reactor order.</p><p>[INFO] Reactor Summary:<br>[INFO]<br>[INFO] eventtutorial … SUCCESS [0.077s]<br>[INFO] Apache Karaf :: Shell eventhandler/add Commands … SUCCESS [3.982s]<br>[INFO] eventpublisher … SUCCESS [13.860s]<br>[INFO] eventkar-kar … SUCCESS [1.012s]</p></blockquote><h3 id="programming-with-event-subscription"><a class="markdownIt-Anchor" href="#programming-with-event-subscription"></a> Programming with Event Subscription</h3><p>BundleActivator is an interface that may be implemented when a bundle is started or stopped. And it should be specified through the Bundle-Activator Manifest header.</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Activator</span> <span class="keyword">implements</span> <span class="title class_">BundleActivator</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">start</span><span class="params">(BundleContext context)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        System.out.println(getBundleName(context) + <span class="string">&quot; Started ...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">stop</span><span class="params">(BundleContext context)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        System.out.println(getBundleName(context) + <span class="string">&quot; Stoped ...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String <span class="title function_">getBundleName</span><span class="params">(BundleContext context)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> context.getBundle().getHeaders().get(<span class="string">&quot;Bundle-Name&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Next, tell the bundle to use this interface in the META-INF\MANIFEST.MF. Such file is automatic generated by Maven plugin maven-bundle-plugin.<br>But <code>Bundle-Activator</code> header is not included by using archetype <code>karaf-command-archetype</code>, we need to add it back.</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.felix<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-bundle-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.5.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">extensions</span>&gt;</span>true<span class="tag">&lt;/<span class="name">extensions</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">instructions</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">Bundle-SymbolicName</span>&gt;</span>$&#123;project.artifactId&#125;<span class="tag">&lt;/<span class="name">Bundle-SymbolicName</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">Bundle-Activator</span>&gt;</span>tk.wangkexiong.osgi.Activator<span class="tag">&lt;/<span class="name">Bundle-Activator</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">Export-Package</span>&gt;</span>tk.wangkexiong.osgi*;version=$&#123;project.version&#125;<span class="tag">&lt;/<span class="name">Export-Package</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">Import-Package</span>&gt;</span>!tk.wangkexiong.osgi*,</span><br><span class="line">                org.apache.aries.blueprint,</span><br><span class="line">                org.osgi.service.blueprint.container,</span><br><span class="line">                org.osgi.service.blueprint.reflect,</span><br><span class="line">                org.apache.felix.service.command,</span><br><span class="line">                org.apache.karaf.shell.commands,</span><br><span class="line">                org.apache.karaf.shell.console,</span><br><span class="line">                *<span class="tag">&lt;/<span class="name">Import-Package</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">instructions</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br></pre></td></tr></table></figure><p>We are going add 3 commands: add/remove/list under eventhandler scope. For add operation, we need to register the event topic with its eventhandler. While for remove, we need to unregister them. Thus we need a hashmap to record our event topic and its eventhandler instance.</p><p>The event service registration API is provided by bundleContext. We could inject it by Blueprint service, DI like Sprint.</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EventRepository</span> <span class="keyword">implements</span> <span class="title class_">BundleContextAware</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Map&lt;String, Registry&gt; eventHandlers = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;String, Registry&gt;();</span><br><span class="line">    <span class="keyword">protected</span> BundleContext bundleContext;</span><br><span class="line"></span><br><span class="line">    ......</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setBundleContext</span><span class="params">(BundleContext bundleContext)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.bundleContext = bundleContext;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> BundleContext <span class="title function_">getBundleContext</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">Bundle</span> <span class="variable">framework</span> <span class="operator">=</span> bundleContext.getBundle(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> (framework == <span class="literal">null</span>) ? bundleContext : framework.getBundleContext();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>And the Blueprint configuration xml is under <code>eventtutorial/eventconsumer/src/main/resources/OSGI-INF/blueprint</code>. Our skelton already includes file named shell-log.xml. We can use it or rename its name as you like.</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;repository&quot;</span> <span class="attr">class</span>=<span class="string">&quot;tk.wangkexiong.osgi.business.EventRepository&quot;</span> <span class="attr">destroy-method</span>=<span class="string">&quot;cleanup&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;bundleContext&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;blueprintBundleContext&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure><p>Now MODIFY generated code for Karaf shell command eventhandler:add. Here I renamed the add.java to AddEventCommand.java</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Command(scope = &quot;eventhandler&quot;, name = &quot;add&quot;, description = &quot;Add an event listener.&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AddEventCommand</span> <span class="keyword">extends</span> <span class="title class_">OsgiCommandSupport</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">DESC</span> <span class="operator">=</span></span><br><span class="line">        <span class="string">&quot;The event topic to listen to (*, org/apache/karaf, org/apache/karaf/*,&quot;</span> +</span><br><span class="line">        <span class="string">&quot;org/apache/karaf/log, org.apache/karaf/log2),\n&quot;</span> +</span><br><span class="line">        <span class="string">&quot;only one handler per topic will be created.&quot;</span> +</span><br><span class="line">        <span class="string">&quot;The filter is space separated.&quot;</span>;</span><br><span class="line">    <span class="meta">@Argument(index = 0, name = &quot;filter&quot;, description = DESC, required = true, multiValued = false)</span></span><br><span class="line">    String filter;</span><br><span class="line">    EventRepository repository;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> Object <span class="title function_">doExecute</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        repository.addEvent(filter);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setRepository</span><span class="params">(EventRepository respository)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.repository = respository;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Change Blueprint configuration to inject the repository for AddEventCommand, and map the command eventhandler:add with our implementation class.</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">command</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">action</span> <span class="attr">class</span>=<span class="string">&quot;tk.wangkexiong.osgi.karaf.AddEventCommand&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;repository&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;repository&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">action</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">command</span>&gt;</span></span><br></pre></td></tr></table></figure><p>Finally, we could write our business logic for add command.</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EventRepository</span> <span class="keyword">implements</span> <span class="title class_">BundleContextAware</span> &#123;</span><br><span class="line">    ......</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title function_">addEvent</span><span class="params">(String filter)</span> <span class="keyword">throws</span> InvalidSyntaxException &#123;</span><br><span class="line">        <span class="keyword">if</span> (!eventHandlers.containsKey(filter)) &#123;</span><br><span class="line">            <span class="type">EventHandler</span> <span class="variable">handler</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">EventDisplayer</span>();</span><br><span class="line">            Dictionary&lt;String, String&gt; properties = <span class="keyword">new</span> <span class="title class_">Hashtable</span>&lt;String, String&gt;();</span><br><span class="line">            properties.put(EventConstants.EVENT_TOPIC, filter);</span><br><span class="line"></span><br><span class="line">            ServiceRegistration&lt;?&gt; registration = getBundleContext()</span><br><span class="line">                    .registerService(EventHandler.class.getName(),</span><br><span class="line">                                     handler, properties);</span><br><span class="line"></span><br><span class="line">            <span class="type">Registry</span> <span class="variable">registry</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Registry</span>(handler, registration);</span><br><span class="line">            eventHandlers.put(filter, registry);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ......</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EventDisplayer</span> <span class="keyword">implements</span> <span class="title class_">EventHandler</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">handleEvent</span><span class="params">(Event event)</span> &#123;</span><br><span class="line">        <span class="type">StringBuilder</span> <span class="variable">builder</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line">        builder.append(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">        builder.append(<span class="string">&quot;### Event received ###&quot;</span>);</span><br><span class="line">        builder.append(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">        builder.append(event.getTopic());</span><br><span class="line">        builder.append(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (String property : event.getPropertyNames()) &#123;</span><br><span class="line">            builder.append(<span class="string">&quot;\t&quot;</span>);</span><br><span class="line">            builder.append(property);</span><br><span class="line">            builder.append(<span class="string">&quot;-&gt;&quot;</span>);</span><br><span class="line">            builder.append(event.getProperty(property));</span><br><span class="line">            builder.append(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        System.out.println(builder.toString());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Command list is used to display all the registered event topic. And Command remove is used to unregister the service and remove it from our recorded hashmap.</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EventRepository</span> <span class="keyword">implements</span> <span class="title class_">BundleContextAware</span> &#123;</span><br><span class="line">    ......</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title function_">removeEvent</span><span class="params">(String filter)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (eventHandlers.containsKey(filter)) &#123;</span><br><span class="line">            <span class="type">Registry</span> <span class="variable">registry</span> <span class="operator">=</span> eventHandlers.get(filter);</span><br><span class="line">            registry.getRegistration().unregister();</span><br><span class="line"></span><br><span class="line">            releaseResource(registry, registry.getHandler());</span><br><span class="line">            eventHandlers.remove(filter);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Set&lt;String&gt; <span class="title function_">getFilters</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> eventHandlers.keySet();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ......</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="programming-with-event-generation"><a class="markdownIt-Anchor" href="#programming-with-event-generation"></a> Programming with Event Generation</h3><p>The pom.xml file in skelton does not know about OSGI Bundle working, we can copy back the part like the one in eventconsumer module. The source code directory in skelton only includes Scala codes, we can change it to <code>src/main</code>. Thus Java code will be put under <code>src/main/java</code> while Scala will be put under <code>src/main/scala</code>. They still follow the code directory structure rule.</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">groupId</span>&gt;</span>tk.wangkexiong.osgi<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>eventpublisher<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">version</span>&gt;</span>1.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">packaging</span>&gt;</span>bundle<span class="tag">&lt;/<span class="name">packaging</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">sourceDirectory</span>&gt;</span>src/main<span class="tag">&lt;/<span class="name">sourceDirectory</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">testSourceDirectory</span>&gt;</span>src/test<span class="tag">&lt;/<span class="name">testSourceDirectory</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.felix<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-bundle-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;maven-bundle-plugin.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">extensions</span>&gt;</span>true<span class="tag">&lt;/<span class="name">extensions</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">instructions</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">Bundle-SymbolicName</span>&gt;</span>$&#123;project.artifactId&#125;<span class="tag">&lt;/<span class="name">Bundle-SymbolicName</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">Bundle-Version</span>&gt;</span>$&#123;project.version&#125;<span class="tag">&lt;/<span class="name">Bundle-Version</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">Bundle-Activator</span>&gt;</span>tk.wangkexiong.osgi.scala.Activator<span class="tag">&lt;/<span class="name">Bundle-Activator</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">Export-Package</span>&gt;</span>tk.wangkexiong*;version=$&#123;project.version&#125;<span class="tag">&lt;/<span class="name">Export-Package</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">Import-Package</span>&gt;</span>*<span class="tag">&lt;/<span class="name">Import-Package</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">instructions</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br></pre></td></tr></table></figure><p>Programming OSGI with Scala</p><figure class="highlight scala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.osgi.framework._</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Activator</span> <span class="keyword">extends</span> <span class="title">BundleActivator</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">start</span></span>( context: <span class="type">BundleContext</span> ) &#123;</span><br><span class="line">         <span class="keyword">var</span> bundleNames = context.getBundle().getHeaders</span><br><span class="line"></span><br><span class="line">         println(bundleNames.get(<span class="string">&quot;Bundle-Name&quot;</span>) + <span class="string">&quot; Started ...&quot;</span>)</span><br><span class="line">     &#125;</span><br><span class="line"></span><br><span class="line">     <span class="function"><span class="keyword">def</span> <span class="title">stop</span></span>( context: <span class="type">BundleContext</span> )  &#123;</span><br><span class="line">         <span class="keyword">var</span> bundleNames = context.getBundle().getHeaders</span><br><span class="line"></span><br><span class="line">         println(bundleNames.get(<span class="string">&quot;Bundle-Name&quot;</span>) + <span class="string">&quot; Stoped ...&quot;</span>)</span><br><span class="line">     &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Add a new Karaf Shell Command named event, still the bundleContext is dependency injection by Blueprint. Sending event requires EventAdmin service. We use bundleContext to check if that OSGI service is ready. Which means if we don’t have EventAdmin service ready, we cannot send event. In Karaf, we could use <code>feature:install eventadmin</code> to make that bundle installed and running.</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Command(scope = &quot;event&quot;, name = &quot;publish&quot;, description = &quot;Publish Hello Event.&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PublishHelloCommand</span> <span class="keyword">extends</span> <span class="title class_">OsgiCommandSupport</span></span><br><span class="line">    <span class="keyword">implements</span> <span class="title class_">BundleContextAware</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">DESC</span> <span class="operator">=</span> <span class="string">&quot;Say hello to somebody&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Argument(index = 0, name = &quot;topic&quot;, description = DESC, required = true, multiValued = false)</span></span><br><span class="line">    <span class="keyword">protected</span> String topic;</span><br><span class="line">    <span class="meta">@Argument(index = 1, name = &quot;name&quot;, description = DESC, required = true, multiValued = false)</span></span><br><span class="line">    <span class="keyword">protected</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> BundleContext bundleContext;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setBundleContext</span><span class="params">(BundleContext bundleContext)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.bundleContext = bundleContext;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> Object <span class="title function_">doExecute</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        ServiceReference&lt;?&gt; ref = bundleContext.getServiceReference(EventAdmin.class.getName());</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (ref != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="type">EventAdmin</span> <span class="variable">eventAdmin</span> <span class="operator">=</span> (EventAdmin) bundleContext.getService(ref);</span><br><span class="line"></span><br><span class="line">            Dictionary&lt;String, String&gt; properties = <span class="keyword">new</span> <span class="title class_">Hashtable</span>&lt;String, String&gt;();</span><br><span class="line">            properties.put(<span class="string">&quot;name&quot;</span>, <span class="built_in">this</span>.name);</span><br><span class="line"></span><br><span class="line">            <span class="type">Event</span> <span class="variable">event</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Event</span>(<span class="built_in">this</span>.topic, properties);</span><br><span class="line">            eventAdmin.sendEvent(event);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;eventadmin feature is not installed...&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="run-in-the-karaf"><a class="markdownIt-Anchor" href="#run-in-the-karaf"></a> Run in the Karaf</h3><p>First, we do a fresh build and install our bundles in local Maven repository.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ mvn clean install</span><br></pre></td></tr></table></figure><p>In Karaf, we add our bundles using Maven repository.</p><p>You may notice that when install scala-library 2.8, we use <code>wrap</code> type. It is because that release does not include OSGI descriptions. We can use wrap type to deploy no-OSGI jar files(“classical” jar files). The exception information here is a bug that does not impact our bundle usage.</p><p>However, latest Scala-library are already OSGI bundles. The reason why I use version 2.8.0 is that, it is default generated by skelton and I want to show how to use wrap protocol here. If you don’t like it, you can upgrade the Scala version from 2.8.0 to 2.11.7. And remember to remove wrap protocol, because it is already OSGI bundle for 2.11.7.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br></pre></td><td class="code"><pre><span class="line">        __ __                  ____</span><br><span class="line">       / //_/____ __________ _/ __/</span><br><span class="line">      / ,&lt;  / __ `/ ___/ __ `/ /_</span><br><span class="line">     / /| |/ /_/ / /  / /_/ / __/</span><br><span class="line">    /_/ |_|\__,_/_/   \__,_/_/</span><br><span class="line"></span><br><span class="line">  Apache Karaf (3.0.3)</span><br><span class="line"></span><br><span class="line">Hit <span class="string">&#x27;&lt;tab&gt;&#x27;</span> <span class="keyword">for</span> a list of available commands</span><br><span class="line">and <span class="string">&#x27;[cmd] --help&#x27;</span> <span class="keyword">for</span> <span class="built_in">help</span> on a specific <span class="built_in">command</span>.</span><br><span class="line">Hit <span class="string">&#x27;&lt;ctrl-d&gt;&#x27;</span> or <span class="built_in">type</span> <span class="string">&#x27;system:shutdown&#x27;</span> or <span class="string">&#x27;logout&#x27;</span> to shutdown Karaf.</span><br><span class="line"></span><br><span class="line">karaf@root()&gt; feature:install eventadmin</span><br><span class="line">karaf@root()&gt; bundle:install -s mvn:tk.wangkexiong.osgi/eventconsumer/1.0</span><br><span class="line">Karaf :: Shell eventhandler Commands Started ...</span><br><span class="line">Bundle ID: 65</span><br><span class="line">karaf@root()&gt; bundle:install wrap:mvn:org.scala-lang/scala-library/2.8.0</span><br><span class="line">java.lang.ArrayIndexOutOfBoundsException: 176</span><br><span class="line">        at aQute.bnd.osgi.Clazz.classConstRef(Clazz.java:1862)</span><br><span class="line">        at aQute.bnd.osgi.Clazz.crawl(Clazz.java:1166)</span><br><span class="line">        at aQute.bnd.osgi.Clazz.doCode(Clazz.java:1134)</span><br><span class="line">        at aQute.bnd.osgi.Clazz.doAttribute(Clazz.java:945)</span><br><span class="line">        at aQute.bnd.osgi.Clazz.doAttributes(Clazz.java:910)</span><br><span class="line">        at aQute.bnd.osgi.Clazz.parseClassFile(Clazz.java:741)</span><br><span class="line">        at aQute.bnd.osgi.Clazz.parseClassFile(Clazz.java:494)</span><br><span class="line">        at aQute.bnd.osgi.Clazz.parseClassFileWithCollector(Clazz.java:483)</span><br><span class="line">        at aQute.bnd.osgi.Clazz.parseClassFile(Clazz.java:473)</span><br><span class="line">        at aQute.bnd.osgi.Analyzer.analyzeJar(Analyzer.java:2177)</span><br><span class="line">        at aQute.bnd.osgi.Analyzer.analyzeBundleClasspath(Analyzer.java:2083)</span><br><span class="line">        at aQute.bnd.osgi.Analyzer.analyze(Analyzer.java:138)</span><br><span class="line">        at aQute.bnd.osgi.Analyzer.calcManifest(Analyzer.java:616)</span><br><span class="line">        at org.ops4j.pax.swissbox.bnd.BndUtils.createBundle(BndUtils.java:161)</span><br><span class="line">        at org.ops4j.pax.url.wrap.internal.Connection.getInputStream(Connection.java:83)</span><br><span class="line">        at org.apache.felix.framework.util.SecureAction.getURLConnectionInputStream(SecureAction.java:524)</span><br><span class="line">        at org.apache.felix.framework.cache.JarRevision.initialize(JarRevision.java:165)</span><br><span class="line">        at org.apache.felix.framework.cache.JarRevision.&lt;init&gt;(JarRevision.java:77)</span><br><span class="line">        at org.apache.felix.framework.cache.BundleArchive.createRevisionFromLocation(BundleArchive.java:878)</span><br><span class="line">        at org.apache.felix.framework.cache.BundleArchive.reviseInternal(BundleArchive.java:550)</span><br><span class="line">        at org.apache.felix.framework.cache.BundleArchive.&lt;init&gt;(BundleArchive.java:153)</span><br><span class="line">        at org.apache.felix.framework.cache.BundleCache.create(BundleCache.java:277)</span><br><span class="line">        at org.apache.felix.framework.Felix.installBundle(Felix.java:2866)</span><br><span class="line">        at org.apache.felix.framework.BundleContextImpl.installBundle(BundleContextImpl.java:165)</span><br><span class="line">        at org.apache.karaf.bundle.command.Install.doExecute(Install.java:43)</span><br><span class="line">        at org.apache.karaf.shell.console.AbstractAction.execute(AbstractAction.java:33)</span><br><span class="line">        at org.apache.karaf.shell.console.OsgiCommandSupport.execute(OsgiCommandSupport.java:39)</span><br><span class="line">        at org.apache.karaf.shell.commands.basic.AbstractCommand.execute(AbstractCommand.java:33)</span><br><span class="line">        at Proxy90baf6b3_ea7e_447e_a609_7de43f4600a4.execute(Unknown Source)</span><br><span class="line">        at Proxy90baf6b3_ea7e_447e_a609_7de43f4600a4.execute(Unknown Source)</span><br><span class="line">        at org.apache.felix.gogo.runtime.CommandProxy.execute(CommandProxy.java:78)</span><br><span class="line">        at org.apache.felix.gogo.runtime.Closure.executeCmd(Closure.java:477)</span><br><span class="line">        at org.apache.felix.gogo.runtime.Closure.executeStatement(Closure.java:403)</span><br><span class="line">        at org.apache.felix.gogo.runtime.Pipe.run(Pipe.java:108)</span><br><span class="line">        at org.apache.felix.gogo.runtime.Closure.execute(Closure.java:183)</span><br><span class="line">        at org.apache.felix.gogo.runtime.Closure.execute(Closure.java:120)</span><br><span class="line">        at org.apache.felix.gogo.runtime.CommandSessionImpl.execute(CommandSessionImpl.java:92)</span><br><span class="line">        at org.apache.karaf.shell.console.impl.jline.ConsoleImpl.run(ConsoleImpl.java:208)</span><br><span class="line">        at org.apache.karaf.shell.console.impl.jline.LocalConsoleManager$2$1<span class="variable">$1</span>.run(LocalConsoleManager.java:109)</span><br><span class="line">        at java.security.AccessController.doPrivileged(Native Method)</span><br><span class="line">        at org.apache.karaf.jaas.modules.JaasHelper.doAs(JaasHelper.java:57)</span><br><span class="line">        at org.apache.karaf.shell.console.impl.jline.LocalConsoleManager$2<span class="variable">$1</span>.run(LocalConsoleManager.java:102)</span><br><span class="line">java.lang.ArrayIndexOutOfBoundsException: 176</span><br><span class="line">        at aQute.bnd.osgi.Clazz.classConstRef(Clazz.java:1862)</span><br><span class="line">        at aQute.bnd.osgi.Clazz.crawl(Clazz.java:1166)</span><br><span class="line">        at aQute.bnd.osgi.Clazz.doCode(Clazz.java:1134)</span><br><span class="line">        at aQute.bnd.osgi.Clazz.doAttribute(Clazz.java:945)</span><br><span class="line">        at aQute.bnd.osgi.Clazz.doAttributes(Clazz.java:910)</span><br><span class="line">        at aQute.bnd.osgi.Clazz.parseClassFile(Clazz.java:741)</span><br><span class="line">        at aQute.bnd.osgi.Clazz.parseClassFile(Clazz.java:494)</span><br><span class="line">        at aQute.bnd.osgi.Clazz.parseClassFileWithCollector(Clazz.java:483)</span><br><span class="line">        at aQute.bnd.osgi.Clazz.parseClassFile(Clazz.java:473)</span><br><span class="line">        at aQute.bnd.osgi.Analyzer.analyzeJar(Analyzer.java:2177)</span><br><span class="line">        at aQute.bnd.osgi.Analyzer.analyzeBundleClasspath(Analyzer.java:2083)</span><br><span class="line">        at aQute.bnd.osgi.Analyzer.analyze(Analyzer.java:138)</span><br><span class="line">        at aQute.bnd.osgi.Analyzer.calcManifest(Analyzer.java:616)</span><br><span class="line">        at org.ops4j.pax.swissbox.bnd.BndUtils.createBundle(BndUtils.java:161)</span><br><span class="line">        at org.ops4j.pax.url.wrap.internal.Connection.getInputStream(Connection.java:83)</span><br><span class="line">        at org.apache.felix.framework.util.SecureAction.getURLConnectionInputStream(SecureAction.java:524)</span><br><span class="line">        at org.apache.felix.framework.cache.JarRevision.initialize(JarRevision.java:165)</span><br><span class="line">        at org.apache.felix.framework.cache.JarRevision.&lt;init&gt;(JarRevision.java:77)</span><br><span class="line">        at org.apache.felix.framework.cache.BundleArchive.createRevisionFromLocation(BundleArchive.java:878)</span><br><span class="line">        at org.apache.felix.framework.cache.BundleArchive.reviseInternal(BundleArchive.java:550)</span><br><span class="line">        at org.apache.felix.framework.cache.BundleArchive.&lt;init&gt;(BundleArchive.java:153)</span><br><span class="line">        at org.apache.felix.framework.cache.BundleCache.create(BundleCache.java:277)</span><br><span class="line">        at org.apache.felix.framework.Felix.installBundle(Felix.java:2866)</span><br><span class="line">        at org.apache.felix.framework.BundleContextImpl.installBundle(BundleContextImpl.java:165)</span><br><span class="line">        at org.apache.karaf.bundle.command.Install.doExecute(Install.java:43)</span><br><span class="line">        at org.apache.karaf.shell.console.AbstractAction.execute(AbstractAction.java:33)</span><br><span class="line">        at org.apache.karaf.shell.console.OsgiCommandSupport.execute(OsgiCommandSupport.java:39)</span><br><span class="line">        at org.apache.karaf.shell.commands.basic.AbstractCommand.execute(AbstractCommand.java:33)</span><br><span class="line">        at Proxy90baf6b3_ea7e_447e_a609_7de43f4600a4.execute(Unknown Source)</span><br><span class="line">        at Proxy90baf6b3_ea7e_447e_a609_7de43f4600a4.execute(Unknown Source)</span><br><span class="line">        at org.apache.felix.gogo.runtime.CommandProxy.execute(CommandProxy.java:78)</span><br><span class="line">        at org.apache.felix.gogo.runtime.Closure.executeCmd(Closure.java:477)</span><br><span class="line">        at org.apache.felix.gogo.runtime.Closure.executeStatement(Closure.java:403)</span><br><span class="line">        at org.apache.felix.gogo.runtime.Pipe.run(Pipe.java:108)</span><br><span class="line">        at org.apache.felix.gogo.runtime.Closure.execute(Closure.java:183)</span><br><span class="line">        at org.apache.felix.gogo.runtime.Closure.execute(Closure.java:120)</span><br><span class="line">        at org.apache.felix.gogo.runtime.CommandSessionImpl.execute(CommandSessionImpl.java:92)</span><br><span class="line">        at org.apache.karaf.shell.console.impl.jline.ConsoleImpl.run(ConsoleImpl.java:208)</span><br><span class="line">        at org.apache.karaf.shell.console.impl.jline.LocalConsoleManager$2$1<span class="variable">$1</span>.run(LocalConsoleManager.java:109)</span><br><span class="line">        at java.security.AccessController.doPrivileged(Native Method)</span><br><span class="line">        at org.apache.karaf.jaas.modules.JaasHelper.doAs(JaasHelper.java:57)</span><br><span class="line">        at org.apache.karaf.shell.console.impl.jline.LocalConsoleManager$2<span class="variable">$1</span>.run(LocalConsoleManager.java:102)</span><br><span class="line">Bundle ID: 66</span><br><span class="line">karaf@root()&gt; bundle:install -s mvn:tk.wangkexiong.osgi/eventpublisher/1.0</span><br><span class="line">Karaf :: Shell event Commands Started ...</span><br><span class="line">Bundle ID: 67</span><br><span class="line">karaf@root()&gt; eventhandler:list</span><br><span class="line">Registered EventHandler Topics</span><br><span class="line"></span><br><span class="line">karaf@root()&gt; eventhandler:add tk/wangkexiong</span><br><span class="line">karaf@root()&gt; event:publish tk/wangkexiong morning!</span><br><span class="line"></span><br><span class="line"><span class="comment">### Event received ###</span></span><br><span class="line">tk/wangkexiong</span><br><span class="line">        name-&gt;morning!</span><br><span class="line">        event.topics-&gt;tk/wangkexiong</span><br><span class="line"></span><br><span class="line">karaf@root()&gt; event:publish xxx/yyy morning!</span><br><span class="line">karaf@root()&gt; eventhandler:add xxx/yyy</span><br><span class="line">karaf@root()&gt; event:publish xxx/yyy morning!</span><br><span class="line"></span><br><span class="line"><span class="comment">### Event received ###</span></span><br><span class="line">xxx/yyy</span><br><span class="line">        name-&gt;morning!</span><br><span class="line">        event.topics-&gt;xxx/yyy</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="generate-kar-package"><a class="markdownIt-Anchor" href="#generate-kar-package"></a> Generate KAR package</h3><p>The programming for KAR package is very easy when using Maven <code>karaf-maven-plugin</code>. The Karaf feature file is already generated in skelton, we need to add dependency feature and bundles in the feature file. The plugin will help to include them all in the kar package. Edit the feature file named as <code>eventkar/src/main/feature/feature.xml</code></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">features</span> <span class="attr">name</span>=<span class="string">&quot;$&#123;project.artifactId&#125;-$&#123;project.version&#125;&quot;</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://karaf.apache.org/xmlns/features/v1.0.0&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">feature</span> <span class="attr">name</span>=<span class="string">&#x27;$&#123;project.artifactId&#125;&#x27;</span> <span class="attr">description</span>=<span class="string">&#x27;$&#123;project.name&#125;&#x27;</span> <span class="attr">version</span>=<span class="string">&#x27;$&#123;project.version&#125;&#x27;</span> <span class="attr">resolver</span>=<span class="string">&quot;$&#123;resolver&#125;&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">details</span>&gt;</span>$&#123;project.description&#125;<span class="tag">&lt;/<span class="name">details</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">feature</span>&gt;</span>eventadmin<span class="tag">&lt;/<span class="name">feature</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">bundle</span> <span class="attr">start-level</span>=<span class="string">&#x27;40&#x27;</span>&gt;</span>wrap:mvn:org.scala-lang/scala-library/2.8.0<span class="tag">&lt;/<span class="name">bundle</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">bundle</span>&gt;</span>mvn:tk.wangkexiong.osgi/eventconsumer/1.0<span class="tag">&lt;/<span class="name">bundle</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">bundle</span>&gt;</span>mvn:tk.wangkexiong.osgi/eventpublisher/1.0<span class="tag">&lt;/<span class="name">bundle</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">feature</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">features</span>&gt;</span></span><br></pre></td></tr></table></figure><p>Let’s do a fresh build and the kar package is generated under <code>eventkar/target/</code>, which can be placed under <code>$KARAF_HOME/deploy/</code>.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ mvn clean package</span><br></pre></td></tr></table></figure><h2 id="conclusion"><a class="markdownIt-Anchor" href="#conclusion"></a> Conclusion</h2><p>Using Maven do a great help for OSGI programming and deployment. However, we did not include basic concepts for OSGI/Bundles/OSGI Service Registry/Blueprint here. Please use <a target="_blank" rel="noopener" href="https://www.google.com/#q=osgi">Google</a> for more information. And please note, the command shell in Karaf may be different from different version. Reading information from <a target="_blank" rel="noopener" href="http://karaf.apache.org">Karaf web site</a> is necessary before your start.</p><p>p.s There is a Good PPT include almost everything for Karaf Programming, here is the <a target="_blank" rel="noopener" href="http://www.anova.be/files/osgi_karaf_slides.pdf">link</a>.</p></div><footer class="post-footer"><div class="post-tags"><a href="/tags/osgi/" rel="tag"><i class="fa fa-tag"></i> osgi</a><a href="/tags/karaf/" rel="tag"><i class="fa fa-tag"></i> karaf</a></div><div class="post-nav"><div class="post-nav-item"><a href="/2015-aerospike-notes/" rel="prev" title="AEROSPIKE notes"><i class="fa fa-chevron-left"></i> AEROSPIKE notes</a></div><div class="post-nav-item"><a href="/2016-docker-notes/" rel="next" title="Docker Notes">Docker Notes<i class="fa fa-chevron-right"></i></a></div></div></footer></article></div><script>window.addEventListener("tabs:register",()=>{let{activeClass:t}=CONFIG.comments;if(CONFIG.comments.storage&&(t=localStorage.getItem("comments_active")||t),t){let e=document.querySelector(`a[href="#comment-${t}"]`);e&&e.click()}}),CONFIG.comments.storage&&window.addEventListener("tabs:click",t=>{if(!t.target.matches(".tabs-comment .tab-content .tab-pane"))return;let e=t.target.classList[1];localStorage.setItem("comments_active",e)})</script></div><div class="toggle sidebar-toggle"><span class="toggle-line toggle-line-first"></span><span class="toggle-line toggle-line-middle"></span><span class="toggle-line toggle-line-last"></span></div><aside class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc">Table of Contents</li><li class="sidebar-nav-overview">Overview</li></ul><div class="post-toc-wrap sidebar-panel"><div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#karaf-installation-and-startup"><span class="nav-number">1.</span> <span class="nav-text">Karaf Installation and Startup</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#build-karaf-osgi-bundle-using-maven"><span class="nav-number">2.</span> <span class="nav-text">Build Karaf OSGI Bundle using Maven</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#build-from-scratch-for-the-project"><span class="nav-number">2.1.</span> <span class="nav-text">Build from scratch for the project</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#programming-with-event-subscription"><span class="nav-number">2.2.</span> <span class="nav-text">Programming with Event Subscription</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#programming-with-event-generation"><span class="nav-number">2.3.</span> <span class="nav-text">Programming with Event Generation</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#run-in-the-karaf"><span class="nav-number">2.4.</span> <span class="nav-text">Run in the Karaf</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#generate-kar-package"><span class="nav-number">2.5.</span> <span class="nav-text">Generate KAR package</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#conclusion"><span class="nav-number">3.</span> <span class="nav-text">Conclusion</span></a></li></ol></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="site-author-image" itemprop="image" alt="wangkexiong" src="//www.gravatar.com/avatar/f26b0e5c590dca182ea3b955f73769e7"><p class="site-author-name" itemprop="name">wangkexiong</p><div class="site-description" itemprop="description">Learning, Memory and Knowledge</div></div><div class="site-state-wrap motion-element"><nav class="site-state"><div class="site-state-item site-state-posts"><a href="/archives/"><span class="site-state-item-count">12</span> <span class="site-state-item-name">posts</span></a></div><div class="site-state-item site-state-categories"><a href="/categories/"><span class="site-state-item-count">4</span> <span class="site-state-item-name">categories</span></a></div><div class="site-state-item site-state-tags"><a href="/tags/"><span class="site-state-item-count">10</span> <span class="site-state-item-name">tags</span></a></div></nav></div><div class="links-of-author motion-element"><span class="links-of-author-item"><a target="_blank" rel="noopener" href="//github.com/wangkexiong" title="GitHub → &#x2F;&#x2F;github.com&#x2F;wangkexiong"><i class="fa fa-fw fa-github"></i></a></span></div><div class="cc-license motion-element" itemprop="license"><a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" class="cc-opacity" rel="noopener" target="_blank"><img src="/images/cc-by-nc-sa.svg" alt="Creative Commons"></a></div></div></div></aside><div id="sidebar-dimmer"></div></div></main><footer class="footer"><div class="footer-inner"><div class="copyright">&copy; 2013 – <span itemprop="copyrightYear">2023</span><span class="with-love"><i class="fa fa-user-circle-o"></i></span> <span class="author" itemprop="copyrightHolder">wangkexiong</span> <span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-area-chart"></i></span> <span title="Symbols count total">65k</span> <span class="post-meta-divider">|</span><span class="post-meta-item-icon"><i class="fa fa-coffee"></i></span> <span title="Reading time total">59 mins.</span></div><div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a></div></div></footer></div><script src="/lib/anime.min.js"></script><script src="/js/utils.js"></script><script src="/js/schemes/pisces.js"></script><script src="/js/next-boot.js"></script><script>!function(){var t=document.createElement("script"),e=window.location.protocol.split(":")[0];t.src="https"===e?"https://zz.bdstatic.com/linksubmit/push.js":"http://push.zhanzhang.baidu.com/push.js";var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(t,s)}()</script><script src="/js/local-search.js"></script></body></html>